<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./tutorial_easy_files/filelist.xml">
<title>Untitled Document</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Greg Detre</o:Author>
  <o:LastAuthor>Greg Detre</o:LastAuthor>
  <o:Revision>244</o:Revision>
  <o:TotalTime>147</o:TotalTime>
  <o:Created>2005-08-18T08:37:00Z</o:Created>
  <o:LastSaved>2005-08-18T11:12:00Z</o:LastSaved>
  <o:Pages>10</o:Pages>
  <o:Words>2233</o:Words>
  <o:Characters>12071</o:Characters>
  <o:Company>-</o:Company>
  <o:Lines>323</o:Lines>
  <o:Paragraphs>203</o:Paragraphs>
  <o:CharactersWithSpaces>14568</o:CharactersWithSpaces>
  <o:Version>9.2720</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:decorative;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:553663111 0 0 0 66047 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:"Times New Roman";
	mso-bidi-font-family:Arial;
	font-weight:bold;}
p.MsoNormalIndent, li.MsoNormalIndent, div.MsoNormalIndent
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.MsoFootnoteReference
	{vertical-align:super;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyTextIndent2, li.MsoBodyTextIndent2, div.MsoBodyTextIndent2
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBlockText, li.MsoBlockText, div.MsoBlockText
	{margin-top:0cm;
	margin-right:72.0pt;
	margin-bottom:6.0pt;
	margin-left:72.0pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	background:navy;
	font-size:12.0pt;
	font-family:Tahoma;
	mso-fareast-font-family:"Times New Roman";}
p
	{margin-right:0cm;
	mso-margin-top-alt:auto;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:36.0pt;
	mso-footer-margin:36.0pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:156265043;
	mso-list-type:hybrid;
	mso-list-template-ids:-1985832020 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l1
	{mso-list-id:1989702696;
	mso-list-type:hybrid;
	mso-list-template-ids:-267223234 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l2
	{mso-list-id:2145150907;
	mso-list-type:hybrid;
	mso-list-template-ids:-1747157840 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l2:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
</head>

<body lang=EN-GB link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<h1>Princeton multi-voxel pattern analysis tutorial</h1>

<p align=right style='text-align:right'>16/08/2005 </p>

<p align=right style='text-align:right'>Version 1</p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>This tutorial will run
through the basics of [a single subject analysis], classifying fMRI
brain states into different conditions [using the distributed pattern
analysis technique].

<o:p></o:p></span></p>

<p>[Start with an theoretical overview of what we are hoping to
 achieve here:] Speficically, this analysis will use an AFNI dataset reported in Haxby et al
 (Science, 2001) that is provided with the toolbox, in which
 participants viewed different classes of visual objects.  The goal of
 the analysis is to classify the distributed patterns of neural
 activity in order to predict psychological states (i.e., viewing a
 face) from the neural state (e.g., BOLD pattern in occipitotemporal cortex)
 .<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>The Matlab code described
below is reproduced from <span style='font-variant:small-caps'>tutorial_easy.m</span>,
which contains briefer inline comments than this narrative.<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>For further information,
see the main documentation in <a href="manual.htm">manual.htm</a>.<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>If you&#8217;re confused about
any of the terminology, please see the Glossary.<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>We called this document
&#8216;tutorial_easy.htm&#8217;. Don&#8217;t let that fool you. We&#8217;ve really done everything we
can to trip you up with it. Just wait till you try the tutorial_hard which we
plan to write in the future. It will be so difficult and scary that small
children will cry around the globe whenever a copy is downloaded. In the
meantime, let us begin.</span></p>

<h2><a name="_What_you_will"></a><span lang=EN-US style='mso-ansi-language:
EN-US'>What you will need to start with</span></h2>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>Everything you need for
this tutorial is included as part of the toolbox. Besides all the main .m
files, you&#8217;ll need these files:</span></p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span lang=EN-US style='mso-ansi-language:EN-US'>a
dataset in AFNI format &#8211; <span style='font-variant:small-caps'>10runs+orig.brik
and .head</span></span></p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span lang=EN-US style='mso-ansi-language:EN-US'>regressors
information &#8211; <span style='font-variant:small-caps'>tutorial_regs.mat</span></span></p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span lang=EN-US style='font-family:
Symbol;mso-ansi-language:EN-US'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span lang=EN-US style='mso-ansi-language:EN-US'>runs information
&#8211; <span style='font-variant:small-caps'>tutorial_runs.mat</span><o:p></o:p></span></p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo2;
tab-stops:list 36.0pt'><![if !supportLists]><span lang=EN-US style='font-family:
Symbol;mso-ansi-language:EN-US'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span lang=EN-US style='mso-ansi-language:EN-US'>a mask
in AFNI format &#8211; <span style='font-variant:small-caps'>mask_cat_select_vt+orig.brik
</span>and <span style='font-variant:small-caps'>.head</span><o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>plus the tutorial function
of the same name on which this narrative is based<o:p></o:p></span></p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l0 level1 lfo4;
tab-stops:list 36.0pt'><![if !supportLists]><span lang=EN-US style='font-family:
Symbol;mso-ansi-language:EN-US'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><span lang=EN-US style='font-variant:small-caps;
mso-ansi-language:EN-US'>tutorial_easy.m</span><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<h2><span lang=EN-US style='mso-ansi-language:EN-US'>Setting your paths<o:p></o:p></span></h2>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>Make sure that the main .m
files included in this toolbox have been added to your path. For instance, if
you&#8217;ve downloaded them into ~/fmri/distpat/ (or something like c:\distpat if you&#8217;re
running Windows), type:<o:p></o:p></span></p>

<p><span lang=EN-US style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
mso-ansi-language:EN-US'>&gt;&gt; addpath ~/fmri/distpat/<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>each time you open Matlab.</span><span
lang=EN-US style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>Add this line to
~/matlab/startup.m if you want this path to be automatically added whenever you
start Matlab up. See the Matlab documentation for more information on adding to
your paths.<o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>To check that everything&#8217;s
working, try:<o:p></o:p></span></p>

<p><span lang=EN-US style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
mso-ansi-language:EN-US'>&gt;&gt; help tutorial_easy</span><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p><span lang=EN-US style='mso-ansi-language:EN-US'>Having set your path, make
sure that your working directly contains the .mat files <a
href="#_What_you_will">listed above</a> by navigating to whichever directory
stores them, e.g.<o:p></o:p></span></p>

<p><span lang=EN-US style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
mso-ansi-language:EN-US'>&gt;&gt; cd ~/fmri/distpat/tutorial_data<o:p></o:p></span></p>

<h2><span lang=EN-US style='mso-ansi-language:EN-US'>The Haxby 8 categories
experiment<o:p></o:p></span></h2>

<p class=MsoBodyText><span lang=EN-US style='mso-ansi-language:EN-US'>The
subject in this experiment viewed exemplars of 8 different types of
visual objects (Type A, B, C, etc.).<o:p></o:p></span></p>

<p class=MsoBodyText><span lang=EN-US style='mso-ansi-language:EN-US'>Each run
contained a 9-TR block for each condition with rest in between and at either
end. There are 10 runs of a single subject included in the dataset in this
toolbox.<o:p></o:p></span></p>

<p class=MsoBodyText><span lang=EN-US style='color:blue;mso-ansi-language:EN-US'>why
are there sometimes 5 and sometimes 6 TRs&#8217; worth of rest between blocks???</span><span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoBodyText><span lang=EN-US style='mso-ansi-language:EN-US'>Note that
the individual stimulus presentations within a given category block might not
align with the TRs. right???<o:p></o:p></span></p>

<p class=MsoBodyText><span lang=EN-US style='mso-ansi-language:EN-US'>See the
&#8216;Sample data set&#8217; section in the manual for more information.<o:p></o:p></span></p>

<h2><span lang=EN-US style='mso-ansi-language:EN-US'>The
easy-like-sunday-morning tutorial</span></h2>

<h3>Introduction to the <span style='font-variant:small-caps'>Subject (subj)</span>
structure</h3>

[The goal of this analysis is to teach a classifier to predict which
class of object the subject is viewing on each trial.  To do this, we
need several bits of information: 

A pattern to classify: The BOLD data itself, stored in AFNI format.

A set of regressors: A vector of condition labels that identify each
volume in the data. This is necessary for training the classifier.

A selector: When dealing with classifiers, one cannot train and test
the classifier on the same data.  Doing so would lead to artifically
inflated accuracy. So we will need a set of selectors that indicate
which volumes should be used for testing and which should be used for
training.

A mask: fMRI datasets are notoriously large and unwieldy.  For memory
limitation and statistal reasons, we must reduce the number of voxels
that are included in the analysis.  For this, we need a spatial mask.


<p>This toolbox uses a single structure to house all of these types of
information for an individual subject. As this is the main structure
for each subject, we&#8217;ll call it the <span
style='font-variant:small-caps'>subj</span>. structure</p>

<p> Our analysis will begin by creating a subject structure, and loading
the patterns, selectors, regressors and masks we need.  Later, we will
run the actual analysis by passing the subject structure to the
classifier and supporting functions.</p>

<p>To initialise it for use with the toolbox, we need to specify what we&#8217;re
going to call the experiment (&#8216;haxby8&#8217;) and a unique identifier for the subject
(&#8216;tutorial_subject&#8217;):</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = init_new_subj('haxby8',&#8217;tutorial_subject')<o:p></o:p></span></p>

[USE SUMMARISE(SUBJ)! We don't want them getting familiar with
subj.patterns{} etc]
<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>subj =<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>patterns: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>regressors: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>selectors: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>masks: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1 struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>p: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>s: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>m: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>r: 'Unspecified'<o:p></o:p></span></p>

<p>This displays our new subject structure, and lists the objects
stored therein of our 4 types: <span style='font-variant:small-caps'>patterns,
regressors, selectors </span>and<span style='font-variant:small-caps'> masks</span>.</p>

<p> Eventually, you will have multiple objects in your structure of
each type.  For instance, you load the AFNI dataset, and z-score it.
This will leave you with two patterns in the subject structure.  There
is no limit to the number of objects of each type that can be
contained within the subj structure.</p>


[If you just use summarise(subj), it doesn't show .p, .m, .s., .r, nor
the header info.  These can probably be left out for now.]

<p>The <span style='font-variant:small-caps'>header</span> field stores
descriptive and book-keeping information.</p>

<p>Ignore the last 4 fields for now.</p>

<h3>GLM Regressors</h3>

<p>We&#8217;re going to start by loading in our regressors matrix from a pre-prepared
file. The regressors matrix stores information about which conditions each TR
[correspond] to. It&#8217;s just like the regressors matrix that a GLM would use, so we
will give this set of regressors the name &#8216;glm&#8217;. We will need the regressors
later for training our classifier about which TRs are which.</p>

[I wouldn't call it GLM; I would call it conditions.  Its not at all
similar to the SPM condition-idenfying structure, and GLM regressors
can take any shape, and frequently do]

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
font-variant:small-caps'>&gt;&gt; </span><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>subj = init_new_regressors(subj,'glm')<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>subj
=<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>patterns: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>regressors: {[1x1 struct]}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>selectors: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>masks: {}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1 struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>p: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;</span>s: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>m: 'Unspecified'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>r: 'glm'<o:p></o:p></span></p>

<p class=MsoNormal><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal><span style='color:blue'>should I use the summarise function
instead of looking at the subj directly???</span><span style='font-variant:
small-caps'><o:p></o:p></span></p>

<p>Note that now the <span style='font-variant:small-caps'>regressors</span>
cell array contains our newly-initialized <span style='font-variant:small-caps'>regressors</span>
object.</p>

<p>Let&#8217;s load in the actual regressors matrix we&#8217;re going to use from the
pre-prepared <span style='font-variant:small-caps'>tutorial_regs.mat</span>
file.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
load('tutorial_regs')<o:p></o:p></span></p>

<p>This will load in a variable called <span style='font-variant:small-caps'>regs</span>
which is just a matrix of conditions x timepoints (8 x 1210).</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
whos<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun: yes">&nbsp;
</span>Name<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Size<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Bytes<span style="mso-spacerun: yes">&nbsp; </span>Class<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun: yes">&nbsp;
</span>regs<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>8x1210<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>77440<span style="mso-spacerun: yes">&nbsp; </span>double array<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun: yes">&nbsp;
</span>subj<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>1x1<span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>3360<span style="mso-spacerun: yes">&nbsp; </span>struct array<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>Grand total is 9835 elements using
80800 bytes</span></p>

<p>Now, we&#8217;re going to store the matrix that we just loaded in inside our
newly-initialized <span style='font-variant:small-caps'>regressors</span>
object.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = set_regressors(subj,'glm',regs);<o:p></o:p></span></p>

<p>Finally, let&#8217;s just append some information about the 8 conditions in this
regressors matrix. </p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
names = {'face','house','cat','bottle','scissors','shoe','chair','scramble'};<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = set_regressors_field(subj,'glm','condnames',names);<o:p></o:p></span></p>

<p>This latter command just appended the <span style='font-variant:small-caps'>names</span>
cell array of strings to a field called &#8216;condnames&#8217; in the <span
style='font-variant:small-caps'>regressors</span> object called &#8216;glm&#8217;.</p>

<p>Let&#8217;s make things a bit more concrete by examining our newly-created <span
style='font-variant:small-caps'>regressors</span> object:<span
style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman";
font-variant:small-caps'><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>&gt;&gt; subj.regressors{1}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>ans =<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>name: 'glm'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1
struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>mat: [8x1210 double]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>group_name: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>derived_from: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>condnames: {1x8 cell}<o:p></o:p></span></p>

<p>We can see now that the regressors matrix was stored in the <span
style='font-variant:small-caps'>mat </span>field. All objects have a <span
style='font-variant:small-caps'>mat</span> field which stores their main data
matrix. The <span style='font-variant:small-caps'>names</span> cell array of
condition names has been stored in a separate field, and the other required
fields are blank.</p>

<h3>Runs selector</h3>

<p>Now, we&#8217;re going to repeat the same process to store information about which
of the 10 runs (i.e. scanning sessions) each TR came from. This is stored
simply as a row-vector with the same number of timepoints as the regressors, containing
1s, 2s, 3s, etc. This goes in a <span style='font-variant:small-caps'>selector</span>
object (think of these as a set of &#8216;timelabels&#8217;), which we&#8217;ll call &#8216;runs&#8217;:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = init_new_selector(subj,'runs');<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
load('tutorial_runs');<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = set_selector(subj,'runs',runs);<o:p></o:p></span></p>

<p>If we look at the selectors object just created, it looks very similar to
the regressors object:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj.selectors{1}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>ans =<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>name: 'runs'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1
struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>mat: [1210x1 double]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>group_name: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>derived_from: ''<o:p></o:p></span></p>

<h3>Mask</h3>

<p>Before going on to load our data, we first need to create a <span
style='font-variant:small-caps'>mask</span> to restrict the voxels we want to
allow through: </p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = load_AFNI_mask(subj,'VT_category-selective','mask_cat_select_vt+orig');<o:p></o:p></span></p>

<p>This simply initializes a <span style='font-variant:small-caps'>mask</span>
object called &#8216;VT_category_selective&#8217; by loading in the AFNI files called <span
style='font-variant:small-caps'>mask_cat_select_vt+orig.brik</span> and <span
style='font-variant:small-caps'>.head</span>.</p>

<p>This mask happens to be an anatomically-defined ventral temporal mask with a
GLM used to further restrict the voxels. <span style='color:blue'>why a GLM too???</span></p>

<p>To view it:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj.masks{1}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>ans =<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>name: 'VT_category-selective'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1
struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>mat: [64x64x40 double]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>group_name: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>derived_from: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>thresh: NaN</span></p>

<p>This time, the <span style='font-variant:small-caps'>mat</span> field is a boolean
3D volume. Only voxels with a 1 in this matrix will be loaded in by the next
step.</p>

<h3>EPI pattern</h3>

<p>Loading in the data is almost as simple. We&#8217;re going to create a <span
style='font-variant:small-caps'>pattern</span> object called &#8216;epis_from_afni&#8217; to
store our data, and this pattern is only going to include voxels that were
allowed through by the mask we just created called &#8216;VT_category-selective&#8217;.</p>

<p>Because your data may be big and stored in multiple files, <span
style='font-variant:small-caps'>load_AFNI_pattern.m</span> takes a cell array of
strings as its <span style='font-variant:small-caps'>filenames</span> argument.
We will create this first, though it will only have one object.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
raw_filenames{1} = '10runs+orig';<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = load_AFNI_pattern(subj,'epis_from_afni',raw_filenames,'VT_category-selective');<o:p></o:p></span></p>

<p>The pattern itself:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj.patterns{1}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>ans =<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>name: 'epis_from_afni'<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>header: [1x1
struct]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>mat: [577x1210 double]<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>group_name: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp; </span>derived_from: ''<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><span style="mso-spacerun:
yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>masked_by:
'VT_category-selective'<o:p></o:p></span></p>

<p>The raw EPI voxel values are stored as a 2D matrix in the <span
style='font-variant:small-caps'>mat</span> field. The 3D information about
their location has been discarded to make manipulating the data easier and more
memory-efficient.</p>

<p>However, notice that the name of the mask used to decide which voxels are
allowed through is stored in the &#8216;masked_by&#8217; field. This is essential, because when
you decide that you do want to know where a voxel sits inside the brain, or
even identify which voxel is which between differently-masked patterns, you
need to refer to the mask used in creating them. This is discussed in the &#8216;Advanced
&#8211; Figuring out which voxel is which, and where&#8217; section in the manual.</p>

<h3>Waypoint before further pre-processing</h3>

<p>This is a good time to get a cup of coffee or sniff some coke.</p>

<p>By now, your subj structure should look much busier:</p>

<p>???</p>

<h3>Zscoring</h3>

<p>We&#8217;re ready to transform and slim this data down before passing it into the
classifier:</p>

<p>It helps to zscore the data by subtracting out the mean of each voxel&#8217;s
timecourse and scaling it so that the standard deviation of the timecourse is
one.</p>

<p><span style='font-variant:small-caps'>zscore_runs.m</span> actually treats each
run as a separate timecourse, which can help remove any between run differences
due to baseline shifts.</p>

<p>It takes in the name of the pattern you want to zscore, and also the
selector name that contains the runs information, so that it knows how to
zscore each run separately.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj = zscore_runs(subj,'epis_from_afni','runs');<o:p></o:p></span></p>

<p>This step requires the <span style='font-variant:small-caps'>zscore.m</span>
function included in the Matlab Statistics toolbox, although it wouldn&#8217;t be
hard to write your own in its place.</p>

<h3>Creating the cross-validation indices </h3>

<p>This next step is essential, but not as transparent. We are going to create
a group of selectors in anticipation of the n-minus-one cross-validation scheme
that we will use to train and test our classifier.</p>

<p>We have 10 runs, so our cross-validation will have 10 iterations. Each
iteration will involve training a fresh classifier on most of the data (9 of
the 10 runs), and testing on that lonely, withheld run. As a result, every
timepoint gets used as training data in 9 of the iterations and testing data in
one of them.</p>

<p>We are going to create each member of the group of 10 selectors to act as a
kind of temporal mask for one of the iterations.</p>

<p>The only information needed for this is the <span style='font-variant:small-caps'>runs</span>
selector, and the name of the group that we want to create (&#8216;runminusone_xvalid1&#8217;).
All the group-members will be automatically named &#8216;runminusone_xvalid1&#8217;, &#8216;runminusone_xvalid2&#8217;
etc.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
[subj] = create_runminusone_indices(subj,'runs','runminusone_xvalid');<o:p></o:p></span></p>

<p>Call <span style='font-variant:small-caps'>summarise.m</span> on the <span
style='font-variant:small-caps'>subj</span> structure to see that it has added lots
of new selectors:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
summarise(subj)<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p>You can even peer at each one individually, e.g.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
subj.selectors{5}<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>???</span></p>

<h3>ANOVA</h3>

<p>Before actually doing the classification, it usually helps to strip away all
but the voxels that will be most informative. In the machine learning
literature, this is termed &#8216;feature selection&#8217;.</p>

<p>The easiest way to do this is to use an ANOVA which tells you the
probability that a given voxel&#8217;s activity varies significantly between
conditions over the course of the experiment. Note that this ANOVA method runs
completely separately for each voxel, yielding a p value for each.</p>

<p>We will store the statmap of p values from the ANOVA as a <span
style='font-variant:small-caps'>pattern</span>. We can then create a mask from
that statmap of just those voxels which vary significantly between conditions with
a certain threshold probability.</p>

<p>This whole business is unfortunately made more complicated, because it would
be cheating<a style='mso-footnote-id:ftn1' href="#_ftn1" name="_ftnref1"
title=""><span class=MsoFootnoteReference><span style='mso-special-character:
footnote'><![if !supportFootnotes]>[1]<![endif]></span></span></a> if the ANOVA
was run on timepoints that will later be used to test the classifier. Think of
it this way &#8211; if you pass your entire data set through the ANOVA and remove all
but the voxels that vary significantly across conditions, then you can be
certain that your classifier will perform better than chance when being asked
to generalize to timepoints in your experiment. The solution is to ensure that
you run the ANOVA on only those TRs that your classifier will be trained on
later. Since there are going to be multiple iterations, each with a fresh
classifier, you&#8217;re going to need to run the ANOVA multiple times, yielding a separate
mask for each iteration.</p>

<p>Fortunately, the <span style='font-variant:small-caps'>pminusone_anova.m</span>
function will do all that for you, using the group of selector indices that we
just created to decide which TRs to use for each iteration. Besides information
about the:</p>

<p style='margin-top:4.0pt;margin-left:36.0pt;text-indent:-18.0pt;mso-list:
l0 level1 lfo4;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>pattern</p>

<p style='margin-top:4.0pt;margin-left:36.0pt;text-indent:-18.0pt;mso-list:
l0 level1 lfo4;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>regressors</p>

<p style='margin-top:4.0pt;margin-left:36.0pt;text-indent:-18.0pt;mso-list:
l0 level1 lfo4;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>group of selectors to use</p>

<p>we also need to supply it with:</p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo5;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>a name for the group of statmap patterns it&#8217;s going to
generate (&#8216;anova_statmap&#8217;)</p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo5;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>a name for the group of boolean masks it&#8217;s going to generate
by thresholding those statmaps (&#8216;no_peeking&#8217;)</p>

<p style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo5;
tab-stops:list 36.0pt'><![if !supportLists]><span style='font-family:Symbol'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>a threshold to use (0.05).</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
[subj] = pminusone_anova(subj,&#8216;epis_from_afni&#8217;,&#8216;glm&#8217;,'runminusone_xvalid','anova_statmap','no_peeking',0.05);<o:p></o:p></span></p>

<h3>Pre-classification summary</h3>

<p>All the hard work has been done. Let us view our handiwork before feeding it
to the hungry classifier:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
summarise(subj)<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h3>Cross-validation classification</h3>

<p>Let&#8217;s set some arguments for a basic backprop classifier with no hidden
layer, and just leave the rest as the defaults:</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
class_args.class = 'bp';<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
class_args.layers = 2;<o:p></o:p></span></p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
class_args.nHidden = 0;<o:p></o:p></span></p>

<p>Now, just call the <span style='font-variant:small-caps'>cross_validation.m</span>
function, which will call backprop multiple times, once per iteration of the
n-minus-one, iterating through the selector and mask groups each time.</p>

<p><span style='font-family:"Courier New";mso-bidi-font-family:"Times New Roman"'>&gt;&gt;
[subj results] = cross_validation(subj,class_args,'epis_from_afni_z','glm','runminusone_xvalid','no_peeking');<o:p></o:p></span></p>

<h3>Results</h3>

<p>Now, we&#8217;re ready to examine the results that this has generated.</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>&gt;&gt; results<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p>The results.total_perf tells us the proportion of the time that the
classifier guessed correctly on its testing TRs (averaged across all 10 iterations).
This figure is different every time, because the backpropagation network&#8217;s weights
are randomly initialized.</p>

<p>Each iteration contains all the information needed to unpack what happened
during classification.</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>&gt;&gt; results.iteration(1)<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></p>

<p>The most important fields in the iteration are the <span style='font-variant:
small-caps'>out</span> and <span style='font-variant:small-caps'>perfmet</span>
fields.</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>&gt;&gt; results.iteration(1).out<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p>Discuss out field???</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>&gt;&gt; results.iteration(1).perfmet{1}<o:p></o:p></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>???<o:p></o:p></span></p>

<p>Discuss perfmet field???</p>

<p>Refer to the &#8216;Classification&#8217; section in the manual.</p>

<p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<h2>Troubleshooting</h2>

<p class=MsoBodyText>This should work flawlessly, straight out of the box. No,
really, it should.</p>

<p class=MsoBodyText>If it doesn&#8217;t, check the following:</p>

<p class=MsoBodyText style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:
l0 level1 lfo4;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]>Check your paths are right. If they&#8217;re not, Matlab
won&#8217;t be able to find the toolbox functions to run them, and you&#8217;ll get an
error like:</p>

<p class=MsoBodyText style='margin-left:72.0pt'><span style='font-family:"Courier New";
mso-bidi-font-family:"Times New Roman"'>??? Undefined function or variable
'blah'.<o:p></o:p></span></p>

<p class=MsoBodyText style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:
l0 level1 lfo4;tab-stops:list 36.0pt'><![if !supportLists]><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><![endif]><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

</div>

<div style='mso-element:footnote-list'><![if !supportFootnotes]><br clear=all>

<hr align=left size=1 width="33%">

<![endif]>

<div style='mso-element:footnote' id=ftn1>

<p class=MsoFootnoteText><a style='mso-footnote-id:ftn1' href="#_ftnref1"
name="_ftn1" title=""><span class=MsoFootnoteReference><span style='mso-special-character:
footnote'><![if !supportFootnotes]>[1]<![endif]></span></span></a> Also termed &#8216;peeking&#8217;</p>

</div>

</div>

</body>

</html>
